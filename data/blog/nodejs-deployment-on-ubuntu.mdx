---
title: 'NodeJS Deployment on Ubuntu'
summary: "How to set up a Node.js app for production on an Ubuntu server. With a PM2, Nginx and Let's encrypt."
publishedAt: '2021-01-13'
image: '/static/images/blog/node-deployment/node-deployment-header.png'
---

# NodeJS Deployment on Ubuntu

- ## Installing NodeJS ([...more](https://github.com/nodesource/distributions))

```shell
# version 14
curl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -
sudo apt-get install -y nodejs
```

- ## Installing Git

Log into your Ubuntu server as a sudo non-root user.

```shell
$ sudo apt update
```

```shell
$ sudo apt install git
```

```shell
# Confirm successful installation
$ git --version
```

```shell
$ git config --global user.name "Your Name"
$ git config --global user.email "youremail@domain.com"
```

- ## Clone the project

```shell
$ git clone yourproject.git
```

#### configure your project settings. for exmaple:

- You might want to edit you **_env variable_** file.
- [Installing and configuring MongoDB](https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-18-04-source) on the server if you needed.

- ## Install dependencies

```shell
$ npm install
```

> You can also start the app `npm start` and visit the app by typing the `<ip_address>:<port>` in the browser.
> (If the port the app is running on is open)

- ## Setup PM2 (process manager)

Install PM2:

```shell
$ sudo npm i pm2 -g
```

Start the app server:

```shell
$ pm2 start --name customName server.js
# Or whatever your main file is
```

To make sure app starts when reboot:

```shell
$ pm2 startup
```

Some other useful [PM2 commands](https://pm2.keymetrics.io/docs/usage/pm2-doc-single-page/):

```shell
$ pm2 status

$ pm2 list

$ pm2 show <name>

$ pm2 restart <name>

$ pm2 stop <name>

$ pm2 logs

$ pm2 flush
```

> You should now be able to access your app using your IP and port. i.e. `100.200.30.40:500`.
> (If the port is open)

- ## Adjusting the Firewall

We need to enable the ufw firewall and allow the ports that we want to have access to.

> You have to first enable the ufw firewall.

check the status. we want to have the ports `http`, `https` and `ssh` port opened.

```shell
$ sudo ufw status
```

For allowing the ports above, simply run these commands:

```shell
# Port 22
$ sudo ufw allow ssh

# Port 80
$ sudo ufw allow http

# Port 443
$ sudo ufw allow https
```

- ## Installing and configuring Nginx

to install nginx:

```shell
$ sudo apt install nginx
```

go to directory below for configuration:

```shell
$ cd /etc/nginx/sites-available
```

before applying any changes make sure you backup the `config` file:

```shell
$ cp ./config ./config.backup
```

The simplest way of configuring nginx for you NodeJS app is to add the following in server block in `config` file:

```shell
$ sudo nano config
```

add this:

```nginx
server_name www.example.com example.com;

    location / {
        proxy_pass http://localhost:3004; # or whatever port your app is running on
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
```

If you wanted to redirect the www to non-www url add this to the end of server block right after location:

```nginx
# this is for redirecting 'www' to non-www
    if ($host = 'www.example.com') {
        return 301 https://example.com$request_uri;
    }
```

Restart Nginx:

```shell
$ sudo systemctl restart nginx
```

- ## Linking a domain to the server
  for linking a domain to you server you need to set an "A record" for your domain.
  there are many services, but I personally use [Cloudflare](https://www.cloudflare.com/).

> the "A record" is you public server IP (the same IP you use to connect to your server vis SSH)

- ## Add SSL with LetsEncrypt

installing Certbot:

```shell
$ sudo add-apt-repository ppa:certbot/certbot
```

Install Certbot’s Nginx package

```shell
$ sudo apt install python-certbot-nginx
```

Confirming Nginx’s Configuration:

```shell
$ sudo nginx -t
```

Obtaining an SSL Certificate:

```shell
$ sudo certbot --nginx -d example.com -d www.example.com
```

Verifying Certbot Auto-Renewal:

```shell
$ sudo certbot renew --dry-run
```

### Now visit https://example.com and you should see your Node app :)

---

- [How To Set Up a Node.js Application for Production on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-node-js-application-for-production-on-ubuntu-18-04)
- [How To Install Git on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-install-git-on-ubuntu-18-04-quickstart)
- [How To Install MongoDB on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-install-mongodb-on-ubuntu-18-04-source)
- [How To Secure MongoDB on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-secure-mongodb-on-ubuntu-18-04)
- [How To Install Nginx on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-install-nginx-on-ubuntu-18-04)
- [How To Secure Nginx with Let's Encrypt on Ubuntu](https://www.digitalocean.com/community/tutorials/how-to-secure-nginx-with-let-s-encrypt-on-ubuntu-18-04)
